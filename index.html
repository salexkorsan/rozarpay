<!DOCTYPE html>
<html>
<head>
  <title>Vue Razorpay SPA</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>
<body>

<div id="app">
  <h2>Pay ₹{{ amount }}</h2>
  <button @click="payNow">Pay Now</button>
</div>

<script>
const { createApp } = Vue;

createApp({
  data() {
    return {
      amount: 500,
    };
  },
  methods: {
    async payNow() {
      // 1️⃣ Create Order
      const res = await fetch("/.netlify/functions/create-order", {
        method: "POST",
        body: JSON.stringify({ amount: this.amount }),
      });

      const order = await res.json();

      // 2️⃣ Open Razorpay
      const options = {
        key: "rzp_live_Rt3Jqiajgd3RNv",
        amount: order.amount,
        currency: "INR",
        order_id: order.id,
        handler: async (response) => {
          // 3️⃣ Verify Payment
          const verifyRes = await fetch(
            "/.netlify/functions/verify-payment",
            {
              method: "POST",
              body: JSON.stringify(response),
            }
          );

          const result = await verifyRes.json();

          if (result.success) {
            alert("Payment Successful ✅");
          } else {
            alert("Payment Failed ❌");
          }
        },
      };

      const rzp = new Razorpay(options);
      rzp.open();
    },
  },
}).mount("#app");
</script>

</body>
</html>
